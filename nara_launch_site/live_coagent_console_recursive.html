
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>N─АRA Recursive Agent Stack Console</title>
  <style>
    body { font-family: sans-serif; padding: 1em; background: #f5fff5; }
    textarea, pre { width: 100%; padding: 1em; margin-top: 1em; font-family: monospace; }
    button { padding: 0.5em 1em; margin-top: 1em; font-size: 1em; }
    .section { margin-bottom: 2em; }
    #memory, #stack, #log { white-space: pre-wrap; background: #efefef; padding: 1em; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>ЁЯФБ N─АRA Recursive Agent Stack Console</h1>

  <div class="section">
    <h2>ЁЯз╛ Root Agent Code (.nara)</h2>
    <textarea id="naraCode" rows="10" placeholder="рдПрдЬреЗрдВрдЯ 'рдирд┐рд░реАрдХреНрд╖рдХ': рдпрджрд┐ ..."></textarea>
    <button onclick="runRecursiveAgent()">Run Recursive Agent</button>
  </div>

  <div class="section">
    <h2>ЁЯУЪ Agent Stack</h2>
    <pre id="stack"></pre>
  </div>

  <div class="section">
    <h2>ЁЯза Shared Memory</h2>
    <pre id="memory">{}</pre>
  </div>

  <div class="section">
    <h2>ЁЯУЬ Recursive Execution Log</h2>
    <pre id="log"></pre>
  </div>

  <script>
    let sharedMemory = {
      'рд╕рддреНрд░рдГ': 'рднреНрд░рд╖реНрдЯрдГ',
      'рддреНрд░реБрдЯрд┐рдГ': 'LLM connection failed',
    };

    let agentStack = [];

    function spawnAgent(name, logic) {
      return {
        name,
        memory: JSON.parse(JSON.stringify(sharedMemory)), // inherit
        code: logic
      };
    }

    async function runRecursiveAgent() {
      const code = document.getElementById('naraCode').value;
      const log = [];

      agentStack = [spawnAgent('рдирд┐рд░реАрдХреНрд╖рдХ', code)];

      for (let i = 0; i < agentStack.length; i++) {
        const agent = agentStack[i];
        log.push(`ЁЯза Executing Agent: ${agent.name}`);

        if (agent.code.includes("рд╕рддреНрд░рдГ") && agent.memory['рд╕рддреНрд░рдГ'] === 'рднреНрд░рд╖реНрдЯрдГ') {
          log.push("ЁЯФБ рд╕рддреНрд░рдГ == рднреНрд░рд╖реНрдЯрдГ тЖТ рдкреНрд░рддреНрдпреБрдкрдХрд░реНрд╖рдВ underway...");

          if (agent.code.includes("рд╕реНрдореГрддрд┐[\"рд╕реВрддреНрд░рдГ\"]")) {
            agent.memory["рд╕реВрддреНрд░рдГ"] = "https://github.com/Adtiya/nara-language";
            log.push("ЁЯУО Agent updated memory['рд╕реВрддреНрд░рдГ']");
          }

          if (agent.code.includes("рдЖрд╣реНрд╡рд╛рдирдВ")) {
            const mockRes = await fetch("https://jsonplaceholder.typicode.com/posts/2").then(r => r.json());
            agent.memory["рдирд╡рд╛рдЪрд╛рд░рдГ"] = "LLM: " + mockRes.title;
            log.push("ЁЯУб рдЖрд╣реНрд╡рд╛рдирдВ result: " + mockRes.title);
          }

          if (agent.code.includes("рдПрдЬреЗрдВрдЯ")) {
            agentStack.push(spawnAgent('рд╕реБрдзрд╛рд░рдХ', `
              рдпрджрд┐ рд╕реНрдореГрддрд┐["рддреНрд░реБрдЯрд┐рдГ"]:
                  рд╕реНрдореГрддрд┐["рддреНрд░реБрдЯрд┐рдГ"] = "Resolved"
                  рд╕реНрдореГрддрд┐["рдирд╡рд╛рдЪрд╛рд░рдГ"] = "Self-corrected"
            `));
            log.push("ЁЯМ▒ Spawned agent: рд╕реБрдзрд╛рд░рдХ");
          }

          agent.memory['рд╕рддреНрд░рдГ'] = 'рд╕рдВрд╢реЛрдзрд┐рдд';
          log.push("тЬЕ Agent memory['рд╕рддреНрд░рдГ'] тЖТ 'рд╕рдВрд╢реЛрдзрд┐рдд'");
        } else {
          log.push("тЭМ No rules matched for agent: " + agent.name);
        }

        // Update shared memory from agent
        Object.assign(sharedMemory, agent.memory);
      }

      document.getElementById('memory').textContent = JSON.stringify(sharedMemory, null, 2);
      document.getElementById('stack').textContent = agentStack.map(a => a.name).join(" тЖТ ");
      document.getElementById('log').textContent = log.join('\n');
    }
  </script>
</body>
</html>
